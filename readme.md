# SecretSantaTB

Бот-тайный-санта для телеграм.

## Содержимое
- springframework
- com.github.pengrad:java-telegram-bot-api
- postgresql
- spring jpa
- lombok

## Описание
Проект в стадии разработки.
Бот принимает сообщения, идентифицирует пользователя на основе id чата.
Если нужно, то создаёт нового пользователя в базе, или обновляет его данные.
После этого, создаётся токен и сохраняется в SecurityContextHolder,
откуда потом и берётся.
### Команды
Бот содержит enum класс Command где содержатся доступные команды и их настройки:
- Название команды
- Значение для сортировки
- Текст команды
- Название "кнопки" команды
- Настройка показа/скрытия команды
- Настройка показа/скрытия для функционального меню
- Значение индекса меню
- Роли, которым доступна команда(сейчас проверки ролей этого нет)

Все команды поделены на несколько меню.
Еще есть отдельные команды, которые не входят в меню.
Для определения содержимого в сообщении используется статический класс UpdateMapperTB.

### Обработка сообщений
Для приёма сообщений используется класс TelegramBotUpdatesListener.
Для распределения команд используется UpdatesServiceTB.
Этот класс определяет в какой класс-обработчик пойдёт команда:
- CalendarServiceTB
- CellServiceTB
- NavigateServiceTB
- SecretSantaServiceTB
- TechServiceTB
- UserServiceTB

Далее, обычно, выполняются какие-то действия и
отправка сообщения пользователям через классы:
- SenderButtonServiceTB
- SenderCalendarServiceTB 
- SenderMessageServiceTB
- SenderPhotoServiceTB

После запуска программы формируется меню функций в классе
TechServiceTB и устанавливается в классе SenderCommandMenuServiceTB.

## Дополнительно
Программа содержит несколько контроллеров для управления и swagger.
Пока что это не приоритетное направление разработки.

## Сборка
Приложение ориентированно на запуск в докер-контейнере.
Для этого присутствует специальный профиль mainDocker.
Можно сделать и свои профили, если нужно.
Для сборки докер-контейнера используется плагин io.fabric8:docker-maven-plugin.
Чтобы собрать контейнер, нужно иметь установленный докер и запустить команду:

mvn clean package -D env.PROFILE=mainDocker docker:build -f pom.xml

Необходимо наличие базы данных.
Необходимо сформировать docker-compose с нужными параметрами. По желанию .env.
